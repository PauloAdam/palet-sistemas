<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — Sistema de Paletes NLE</title>
  <style>
    :root{ --bg:#071225; --card:#091327; --accent:#60a5fa; --muted:#9fb3cc; color:#e6eef8; font-family:Inter,system-ui,Arial; }
    body{ margin:0; min-height:100vh; display:grid; place-items:center; background:linear-gradient(180deg,#041026,#071428); }
    .box{ width:100%; max-width:420px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:22px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); box-shadow:0 12px 36px rgba(2,6,23,0.6); }
    h1{ margin:0 0 8px 0; font-size:20px }
    p.small{ margin:0 0 16px 0; color:var(--muted); font-size:13px }
    label{ display:block; font-size:13px; margin-top:10px; color:var(--muted) }
    input[type=text], input[type=password]{ width:100%; padding:10px 12px; margin-top:6px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit; }
    .row{ display:flex; gap:8px; margin-top:14px; }
    button{ border:none; background:var(--accent); color:#04233a; padding:10px 14px; border-radius:8px; font-weight:700; cursor:pointer; }
    button.secondary{ background:transparent; color:var(--accent); border:1px solid rgba(96,165,250,0.12) }
    .info{ margin-top:12px; color:var(--muted); font-size:13px }
    .error{ margin-top:12px; color:#ffb4b4; font-size:13px }
    @media (max-width:480px){ .box{ margin:18px } }
  </style>
</head>
<body>
  <div class="box">
    <h1>Entrar — Sistema de Paletes NLE</h1>
    <p class="small">Faça login com sua conta. Usuário admin padrão: <strong>admin</strong> / <strong>admin123</strong></p>

    <label for="username">Usuário</label>
    <input id="username" type="text" placeholder="seu.usuario" autofocus>

    <label for="password">Senha</label>
    <input id="password" type="password" placeholder="*****">

    <div class="row">
      <button id="btnLogin">Entrar</button>
      <button id="btnOffline" class="secondary">Usar modo local</button>
    </div>

    <div id="msg" class="info">Conectando ao servidor...</div>
    <div id="err" class="error" style="display:none"></div>
  </div>

  <script>
    // === CONFIG: altere se o backend estiver em outro host/porta ===
    const API_BASE = 'http://localhost:3000';

    const btnLogin = document.getElementById('btnLogin');
    const btnOffline = document.getElementById('btnOffline');
    const msg = document.getElementById('msg');
    const err = document.getElementById('err');

    // quick ping to backend to show status
    async function ping() {
      try {
        const res = await fetch(API_BASE + '/pallets', { method: 'GET', headers: { 'Content-Type':'application/json' } });
        if (res.status === 401) {
          msg.textContent = 'Servidor online — faça login.';
        } else {
          msg.textContent = 'Servidor respondeu (' + res.status + '). Faça login.';
        }
      } catch (e) {
        msg.textContent = 'Servidor não acessível em ' + API_BASE + ' — modo local disponível.';
      }
    }
    ping();

    btnLogin.onclick = async () => {
      err.style.display = 'none'; err.textContent = '';
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if(!username || !password){ err.style.display='block'; err.textContent='Preencha usuário e senha.'; return; }

      try {
        const res = await fetch(API_BASE + '/login', {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({ username, password })
        });

        const json = await res.json();
        if(!res.ok){ err.style.display='block'; err.textContent = json.error || 'Login falhou'; return; }

        // sucesso: salva token + role e vai pro sistema
        localStorage.setItem('nle_token', json.token);
        localStorage.setItem('nle_role', json.role || 'funcionario');
        // opcional: salvar username
        localStorage.setItem('nle_user', username);
        // redireciona
        window.location.href = 'sistema.html';
      } catch (e) {
        err.style.display='block';
        err.textContent = 'Erro ao conectar com o servidor: ' + e.message;
      }
    };

    // Modo offline: grava um flag e vai para o sistema (usa localStorage no frontend)
    btnOffline.onclick = () => {
      localStorage.setItem('nle_offline','1');
      // role admin para testar? deixamos funcionário por segurança
      localStorage.setItem('nle_role','funcionario');
      window.location.href = 'sistema.html';
    };

    // Enter to submit
    document.addEventListener('keypress', (ev)=>{
      if(ev.key === 'Enter') btnLogin.click();
    });
  </script>
</body>
</html>


